openapi: 3.1.0
info:
  title: LexIA SJF API
  version: 1.0.0
  description: Endpoints de jurisprudencia SJF normalizados para GPT.

servers:
  - url: https://lexia-api.vercel.app

paths:
  /health:
    get:
      operationId: healthLexIA
      summary: Estado del servicio
      responses:
        "200":
          description: Servicio disponible
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  service:
                    type: string

  /health/deep:
    get:
      operationId: deepHealthLexIA
      summary: Estado profundo del servicio y dependencias
      responses:
        "200":
          description: Todas las dependencias operando
        "503":
          description: Alguna dependencia degradada

  /jurisprudencia/buscar:
    get:
      operationId: buscarJurisprudencia
      summary: Buscar jurisprudencia SJF por termino simple
      parameters:
        - name: q
          in: query
          required: false
          schema:
            type: string
          example: amparo
        - name: page
          in: query
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
        - name: size
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 10
        - name: includeRaw
          in: query
          required: false
          schema:
            type: boolean
            default: false
      responses:
        "200":
          description: Resultado paginado normalizado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/JurisprudenciaSearchResponse"

    post:
      operationId: buscarJurisprudenciaAvanzada
      summary: Buscar jurisprudencia SJF con payload avanzado
      parameters:
        - name: page
          in: query
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
        - name: size
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 10
        - name: includeRaw
          in: query
          required: false
          schema:
            type: boolean
            default: false
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                classifiers:
                  type: array
                  items:
                    type: object
                    properties: {}
                searchTerms:
                  type: array
                  items:
                    type: object
                    properties: {}
      responses:
        "200":
          description: Resultado paginado normalizado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/JurisprudenciaSearchResponse"

  /jurisprudencia/detalle:
    get:
      operationId: obtenerDetalleJurisprudencia
      summary: Obtener detalle de tesis por IUS
      parameters:
        - name: ius
          in: query
          required: true
          schema:
            type: integer
        - name: isSemanal
          in: query
          required: false
          schema:
            type: boolean
        - name: hostName
          in: query
          required: false
          schema:
            type: string
            default: https://sjf2.scjn.gob.mx
        - name: includeRaw
          in: query
          required: false
          schema:
            type: boolean
            default: false
      responses:
        "200":
          description: Detalle normalizado de tesis
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/JurisprudenciaDetailResponse"

components:
  schemas:
    JurisprudenciaItem:
      type: object
      properties:
        ius:
          type: integer
          nullable: true
        isSemanal:
          type: boolean
          nullable: true
        rubro:
          type: string
        fechaPublicacion:
          type: string
        instancia:
          type: string
        epoca:
          type: string
        tipoDocumento:
          type: string
        textoSnippet:
          type: string
        raw:
          type: object
          properties: {}

    JurisprudenciaSearchResponse:
      type: object
      properties:
        total:
          type: integer
        totalPages:
          type: integer
        page:
          type: integer
        size:
          type: integer
        count:
          type: integer
        hasMore:
          type: boolean
        items:
          type: array
          items:
            $ref: "#/components/schemas/JurisprudenciaItem"

    JurisprudenciaDetailResponse:
      type: object
      properties:
        ius:
          type: integer
        isSemanalUsed:
          type: boolean
        hostName:
          type: string
        rubro:
          type: string
        fechaPublicacion:
          type: string
        titulo:
          type: string
        texto:
          type: string
        textoPlano:
          type: string
        raw:
          type: object
          properties: {}
